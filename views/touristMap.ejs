<%- include('partials/header',{title,user}) %>
<h2>Live Tourist Map</h2>
<div id="map" style="height:500px"></div>

<script
  src="https://maps.googleapis.com/maps/api/js?key=<%= process.env.GOOGLE_MAPS_KEY %>&callback=initMap"
  async defer>
</script>

<script>
  function initMap() {
    const map = new google.maps.Map(document.getElementById('map'), {
      center: { lat: -41.2865, lng: 174.7762 },
      zoom: 8
    });

    const pins = <%- JSON.stringify(pins) %>;

    pins.forEach(p => {
      // pick a color by density
      let color = 'green';
      if (p.density > 70) color = 'red';
      else if (p.density > 40) color = 'orange';

      new google.maps.Marker({
        position: { lat: p.lat, lng: p.lng },
        map,
        title: `${p.name} — Score ${p.density}`,
        icon: {
          path: google.maps.SymbolPath.CIRCLE,
          scale: 8,
          fillColor: color,
          fillOpacity: 0.8,
          strokeWeight: 1
        }
      });
    });
  }
</script>

<p><a href="/tourist/dashboard">← Back</a></p>

<%- include('partials/footer') %>
